<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Putting U-boot on mini2440 &#8211; Ackerley's Blog</title>
<meta name="description" content="Putting U-boot on mini2440">
<meta name="keywords" content="mini2440">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Putting U-boot on mini2440">
<meta property="og:description" content="Putting U-boot on mini2440">
<meta property="og:url" content="http://ackerleytng.github.io/uboot-mini2440/">
<meta property="og:site_name" content="Ackerley's Blog">





<link rel="canonical" href="http://ackerleytng.github.io/uboot-mini2440/">
<link href="http://ackerleytng.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Ackerley's Blog Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://ackerleytng.github.io/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://ackerleytng.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://ackerleytng.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://ackerleytng.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://ackerleytng.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://ackerleytng.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://ackerleytng.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://ackerleytng.github.io/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://ackerleytng.github.io">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://ackerleytng.github.io/images/avatar.jpg" alt="Ackerley Tng photo" class="author-photo">
					<h4>Ackerley Tng</h4>
					<p>Electrical Engineer at heart. Interested in Computer Architecture, cooking, skating, life, singing and efficiency in general</p>
				</li>
				<li><a href="http://ackerleytng.github.io/about/">Learn More</a></li>
				<li>
					<a href="mailto:ackerleytng@gmail.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				
				
				
				
				
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://ackerleytng.github.io/posts/">All Posts</a></li>
				<li><a href="http://ackerleytng.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->



<div class="entry-header">
  <div class="image-credit">Image source: <a href="http://www.dargadgetz.com/ios-7-abstract-wallpaper-pack-for-iphone-5-and-ipod-touch-retina/">dargadgetz</a></div><!-- /.image-credit -->
  <div class="entry-image">
    <img src="http://ackerleytng.github.io/images/abstract-3.jpg" alt="Putting U-boot on mini2440">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="http://ackerleytng.github.io/uboot-mini2440/" rel="bookmark" title="Putting U-boot on mini2440">Putting U-boot on mini2440</a></h1>
        
        <h2>April 05, 2015</h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~7 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <h1 id="mini2440-setup-guide">mini2440 setup guide</h1>

<p>I hope to make this</p>

<ul>
  <li>Pain free</li>
  <li>As close to first principles as possible so when new versions come out you can still follow this guide</li>
</ul>

<h2 id="building-the-kernel-and-root-file-system">Building the kernel and root file system</h2>

<p>I grabbed the latest version of buildroot off http://buildroot.uclibc.org/downloads/.</p>

<p>The version I got was <code>2015.02</code>. I managed to get Linux 3.18.6 working on the mini2440, but you might want the newest version at the point you’re doing this.</p>

<p>Untar the tarball and go to the extracted directory.</p>

<p>Type <code>make menuconfig</code>.</p>

<p>I tried using the mini2440 defconfig (as in default config), but I kinda tried so many different things that I don’t know which of those are still valid. If you’d like to try the mini2440 defconfig, or at least use that as a starting point, go to <code>&lt; Load &gt;</code> and load <code>configs/mini2440_defconfig</code>.</p>

<p>If not, here’s my final configuration.</p>

<ul>
  <li>Target Architecture: ARM (little endian)</li>
  <li>Target Binary Format: ELF</li>
  <li>Target Architecture Variant: arm920t</li>
  <li>Target ABI: EABI</li>
  <li>Floating point strategy: Soft float</li>
  <li>ARM instruction set: ARM</li>
</ul>

<p>I changed the <code>System hostname</code> and <code>System banner</code> in <code>System configuration</code>, but those are cosmetic.</p>

<p>For Linux kernel configuration, I used a defconfig, and the name of the defconfig is <code>mini2440</code>.</p>

<p>I am using <code>uImage</code> for the <code>Kernel binary format</code></p>

<p>As for filesystem, I selected <code>initial RAM filesystem linked into linux kernel</code></p>

<p>I also selected <code>jffs2 root filesystem</code> and for <code>Flash Type</code>, I selected <code>NAND flash with 2kB Page and 128 kB erasesize</code></p>

<p>This version of buildroot doesn’t build U-Boot properly due to a missing defconfig, so I did not select any bootloader.</p>

<p>Then…</p>

<p><code>
make
</code></p>

<h1 id="putting-u-boot-on-mini2440">Putting U-boot on mini2440</h1>

<p>I got a compiled version of U-boot from http://www.mech.tohoku-gakuin.ac.jp/rde/contents/tech/mini2440/archive/u-boot_20100701.zip, but just in case that file disappears, <a href="/post_downloads/u-boot_20100701.zip">u-boot_20100701.zip</a>.</p>

<p>This zip file contains two tools that you might need to transfer files over USB to the mini2440. After you extract the files in the archive, they will be in the <code>tools/</code> directory. I don’t think there is a difference between <code>s3c2410_boot_usb</code> and <code>usbpush</code>.</p>

<h2 id="hardware-connections">Hardware connections</h2>

<ul>
  <li>Connect the mini2440 to power</li>
  <li>Connect the mini2440 to a USB port on your Linux PC using a Type A (male) to Type B (male) USB cable</li>
  <li>Connect the mini2440 to a serial port on your Linux PC using a serial cable</li>
</ul>

<p>Start minicom</p>

<p><code>
sudo minicom -s
</code></p>

<p>Here are my settings</p>

<p><code>
    +-----------------------------------------------------------------------+
    | A -    Serial Device      : /dev/ttyS0                                |
    | B - Lockfile Location     : /var/lock                                 |
    | C -   Callin Program      :                                           |
    | D -  Callout Program      :                                           |
    | E -    Bps/Par/Bits       : 115200 8N1                                |
    | F - Hardware Flow Control : No                                        |
    | G - Software Flow Control : No                                        |
    |                                                                       |
    |    Change which setting?                                              |
    +-----------------------------------------------------------------------+
            | Screen and keyboard      |
            | Save setup as dfl        |
            | Save setup as..          |
            | Exit                     |
            | Exit from Minicom        |
            +--------------------------+
</code></p>

<p>If you set the NAND/NOR switch on the mini2440 to NOR and power up the mini2440, you should see something like this:</p>

<p><code>
##### FriendlyARM BIOS 2.0 for 2440 #####
[x] format NAND FLASH for Linux
[v] Download vivi
[k] Download linux kernel
[y] Download root_yaffs image
[a] Absolute User Application
[n] Download Nboot for WinCE
[l] Download WinCE boot-logo
[w] Download WinCE NK.bin
[d] Download &amp; Run
[z] Download zImage into RAM
[g] Boot linux from RAM
[f] Format the nand flash
[b] Boot the system
[s] Set the boot parameters
[u] Backup NAND Flash to HOST through USB(upload)
[r] Restore NAND Flash from HOST through USB
[q] Goto shell of vivi
Enter your selection:
</code></p>

<h2 id="conceptually">Conceptually,</h2>

<p>You want to put U-Boot, a bootloader, into NAND flash, which will then load your linux kernel, which would in turn load your root filesystem.</p>

<p>Here’s the final layout you want to achieve</p>

<p>```
MINI2440 # mtdparts</p>

<p>device nand0 <mini2440-nand>, # parts = 4
 #: name                        size            offset          mask_flags
 0: u-boot              0x00040000      0x00000000      0
 1: u-boot_env          0x00020000      0x00040000      0
 2: kernel              0x00500000      0x00060000      0
 3: rootfs              0x0faa0000      0x00560000      0</mini2440-nand></p>

<p>active partition: nand0,0 - (u-boot) 0x00040000 @ 0x00000000</p>

<p>defaults:
mtdids  : nand0=mini2440-nand
mtdparts: <null>
```</null></p>

<h2 id="putting-u-boot-into-nand-flash">Putting U-Boot into NAND flash</h2>

<p>In this section, you’re going to first put U-Boot onto mini2440’s ram, and then run U-Boot from ram to make it do some cleanup, and then get U-Boot to copy itself into NAND flash.</p>

<p>Ask mini2440 to receive U-Boot:</p>

<p>In minicom:</p>

<p><code>
##### FriendlyARM BIOS 2.0 for 2440 #####
[x] format NAND FLASH for Linux
[v] Download vivi
[k] Download linux kernel
[y] Download root_yaffs image
[a] Absolute User Application
[n] Download Nboot for WinCE
[l] Download WinCE boot-logo
[w] Download WinCE NK.bin
[d] Download &amp; Run
[z] Download zImage into RAM
[g] Boot linux from RAM
[f] Format the nand flash
[b] Boot the system
[s] Set the boot parameters
[u] Backup NAND Flash to HOST through USB(upload)
[r] Restore NAND Flash from HOST through USB
[q] Goto shell of vivi
Enter your selection:
</code></p>

<p>Press <code>q</code></p>

<p><code>
Supervivi&gt; load ram &lt;destination-address-in-ram&gt; &lt;size-to-transfer&gt; u
</code></p>

<p>What I used:</p>

<p><code>
Supervivi&gt; load ram 0x32000000 242360 u
</code></p>

<p>Send U-Boot over USB to mini2440. I used <code>u-boot-256M.bin</code>, because my mini2440 had a flash size of 256M. Many sites say that there should be no difference between using <code>u-boot-256M.bin</code> and <code>u-boot-128M.bin</code>, but I used <code>u-boot-256M.bin</code> anyway. On Linux PC:</p>

<p><code>
$ sudo ./tools/s3c2410_boot_usb u-boot_20100701/u-boot-256M.bin
</code>
(Ignore the error if you get one)</p>

<p>Start U-Boot</p>

<p>In minicom:</p>

<p><code>
Supervivi&gt; go 0x32000000
</code></p>

<p>Clear everything in NAND flash</p>

<p><code>
MINI2440 # nand scrub
</code></p>

<p>Create bad block table (This took quite a while for me, be patient)</p>

<p><code>
MINI2440 # nand createbbt
</code></p>

<p>Create/view partitions</p>

<p><code>
MINI2440 # mtdparts
</code></p>

<p>Write uboot to NAND flash. You have some options here.</p>

<p>Raw write, doesn’t look for bad blocks, data might get written to bad block. This will copy the full size of the nand partition, beginning with the address in ram provided.
<code>
MINI2440 # nand write &lt;address-in-ram-in-hex&gt; &lt;partition-in-nand&gt;
</code></p>

<p>Write, taking into account bad blocks
<code>
MINI2440 # nand write.e &lt;source-in-hex&gt; &lt;destination-in-hex&gt; &lt;bytes-to-write-in-hex&gt;
</code></p>

<p>I used</p>

<p><code>
MINI2440 # nand write 0x32000000 u-boot
</code></p>

<p>Partition the NAND</p>

<p><code>
MINI2440# dynpart
</code></p>

<p>Create the dynamic environment space for u-boot</p>

<p><code>
MINI2440# dynenv set u-boot_env
</code></p>

<p>Save the environment to NAND.</p>

<p><code>
MINI2440# saveenv
</code></p>

<p>Switch off the mini2440, flip the NAND/NOR switch to NAND, and switch on the mini2440.</p>

<p>You should get to a <code>MINI2440# </code> prompt. If you don’t, try pressing enter a few times in minicom, the prompt might show up then.</p>

<h2 id="transferring-uimage-into-nand-flash">Transferring uImage into NAND flash</h2>

<p>I transferred using tftp, but you might be able to do it using USB like above.</p>

<p>Find the address of the kernel partition:</p>

<p>```
MINI2440 # mtdparts</p>

<p>device nand0 <mini2440-nand>, # parts = 4
 #: name                        size            offset          mask_flags
 0: u-boot              0x00040000      0x00000000      0
 1: u-boot_env          0x00020000      0x00040000      0
 2: kernel              0x00500000      0x00060000      0
 3: rootfs              0x0faa0000      0x00560000      0</mini2440-nand></p>

<p>active partition: nand0,0 - (u-boot) 0x00040000 @ 0x00000000</p>

<p>defaults:
mtdids  : nand0=mini2440-nand
mtdparts: <null>
```</null></p>

<p>Erase the kernel partition:</p>

<p><code>
MINI2440# nand erase 60000 500000
</code></p>

<p>Set up your network. I connected the mini2440 to my router, and the Linux PC to the router at 192.168.1.50</p>

<p><code>
MINI2440# setenv ipaddr 192.168.1.60
MINI2440# setenv serverip 192.168.1.50
</code></p>

<p>Download uImage from Linux PC over LAN into RAM, at 0x32000000 again. First place <code>uImage</code> into <code>/tftpboot</code> (Google how to set up tftp).</p>

<p><code>
MINI2440# tftp 32000000 uImage
</code></p>

<p>Copy uImage from ram into NAND</p>

<p><code>
MINI2440# nand write.e 32000000 60000 &lt;size-of-uImage-in-hex&gt;
</code></p>

<p>Set the boot command to load kernel image from NAND flash.</p>

<p><code>
MINI2440# setenv bootcmd 'nboot.e kernel;bootm'
MINI2440# saveenv
</code></p>

<p>Power cycle the mini2440, and it should boot into Linux.</p>

<p><code>
Loading from NAND 256MiB 3,3V 8-bit, offset 0x60000
   Image Name:   Linux-3.18.6
   Created:      2015-04-05   4:34:50 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    5350896 Bytes =  5.1 MB
   Load Address: 30008000
   Entry Point:  30008000
## Booting kernel from Legacy Image at 32000000 ...
   Image Name:   Linux-3.18.6
   Created:      2015-04-05   4:34:50 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    5350896 Bytes =  5.1 MB
   Load Address: 30008000
   Entry Point:  30008000
   Verifying Checksum ... OK
   Loading Kernel Image ...
...
</code></p>

<h2 id="heres-my-entire-u-boot-environment-just-in-case">Here’s my entire U-Boot environment, just in case…</h2>

<p>```
MINI2440 # printenv
bootargs=root=/dev/mtdblock3 rootfstype=jffs2 console=ttySAC0,115200
bootdelay=3
baudrate=115200
ethaddr=08:08:11:18:12:27
netmask=255.255.255.0
usbtty=cdc_acm
mini2440=mini2440=0tb
bootargs_base=console=ttySAC0,115200 noinitrd
bootargs_init=init=/sbin/init
root_nand=root=/dev/mtdblock3 rootfstype=jffs2
root_mmc=root=/dev/mmcblk0p2 rootdelay=2
root_nfs=/mnt/nfs
set_root_nfs=setenv root_nfs root=/dev/nfs rw nfsroot=${serverip}:${root_nfs}
ifconfig_static=run setenv ifconfig ip=${ipaddr}:${serverip}::${netmask}:mini2440:eth0
ifconfig_dhcp=run setenv ifconfig ip=dhcp
ifconfig=ip=dhcp
set_bootargs_mmc=setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_mmc}
set_bootargs_nand=setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_nand}
set_bootargs_nfs=run set_root_nfs; setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_nfs} ${ifconfig}
mtdids=nand0=mini2440-nand
mtdparts=mtdparts=mini2440-nand:0x00040000(u-boot),0x00020000(u-boot_env),0x00500000(kernel),0x0faa0000(rootfs)
bootcmd=nboot.e kernel;bootm
ipaddr=192.168.1.60
serverip=192.168.1.50
partition=nand0,0
mtddevnum=0
mtddevname=u-boot</p>

<p>Environment size: 1151/131068 bytes
```</p>

<h1 id="references">References</h1>

<ul>
  <li>http://geekwentfreak-raviteja.rhcloud.com/blog/2010/07/27/flashing-uboot-onto-nand-mini2440/</li>
  <li>http://geekwentfreak-raviteja.rhcloud.com/blog/2010/09/19/mini2440-flashing-linux-uimage-into-nand/</li>
  <li>http://bill.station51.net/?post/2010/01/16/U-Boot-on-Mini2440</li>
  <li>http://e2e.ti.com/support/dsp/davinci_digital_media_processors/f/100/p/210595/745675</li>
</ul>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="http://ackerleytng.github.io/tags/#mini2440" title="Pages tagged mini2440" class="tag">mini2440</a></span>
        <span><a href="http://ackerleytng.github.io/uboot-mini2440/" rel="bookmark" title="Putting U-boot on mini2440">Putting U-boot on mini2440</a> was published on <span class="entry-date date published updated"><time datetime="2015-04-05T00:00:00+08:00">April 05, 2015</time></span></span>
        (revised: <span class="entry-date date modified"><time datetime="2015-04-05">04/05/2015</time></span>)
        <span class="author vcard"><span class="fn"><a href="http://ackerleytng.github.io/about/" title="About Ackerley Tng">Ackerley Tng</a></span></span>
        <div class="social-share">
          <ul class="socialcount socialcount-small inline-list">
            <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http://ackerleytng.github.io/uboot-mini2440/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
            <li class="twitter"><a href="https://twitter.com/intent/tweet?text=http://ackerleytng.github.io/uboot-mini2440/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
            <li class="googleplus"><a href="https://plus.google.com/share?url=http://ackerleytng.github.io/uboot-mini2440/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
          </ul>
        </div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    
    <div class="read-more">
      
        <div class="read-more-header">
          <a href="http://ackerleytng.github.io/fried-okra/" class="read-more-btn">Read More</a>
        </div><!-- /.read-more-header -->
        <div class="read-more-content">
          <h3><a href="http://ackerleytng.github.io/fried-okra/" title="Fried Okra!">Fried Okra!</a></h3>
          <p>Fried Okra <a href="http://ackerleytng.github.io/fried-okra/">Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="http://ackerleytng.github.io/sunday-dinner/" title="Sunday Special Dinner">Sunday Special Dinner</a></h4>
            <span>Published on November 16, 2014</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="http://ackerleytng.github.io/sewing-pencil-case/" title="Making My Own Pencilcase">Making My Own Pencilcase</a></h4>
            <span>Published on October 12, 2014</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
      
    </div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Ackerley Tng. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://ackerleytng.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://ackerleytng.github.io/assets/js/scripts.min.js"></script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ackerleytng'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>	        

</body>
</html>
