<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Ackerley's Blog</title>
<meta name="description" content="Listing of Posts.">
<meta name="keywords" content="Jekyll, theme, themes, responsive, blog, modern">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="Listing of Posts.">
<meta property="og:url" content="http://ackerleytng.github.io/index.html">
<meta property="og:site_name" content="Ackerley's Blog">





<link rel="canonical" href="http://ackerleytng.github.io/">
<link href="http://ackerleytng.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Ackerley's Blog Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://ackerleytng.github.io/assets/css/main.min.css">
<!-- Webfonts -->
<link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://ackerleytng.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://ackerleytng.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://ackerleytng.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://ackerleytng.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://ackerleytng.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://ackerleytng.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://ackerleytng.github.io/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://ackerleytng.github.io">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://ackerleytng.github.io/images/avatar.jpg" alt="Ackerley Tng photo" class="author-photo">
					<h4>Ackerley Tng</h4>
					<p>Electrical Engineer at heart. Interested in Computer Architecture, cooking, skating, life, singing and efficiency in general</p>
				</li>
				<li><a href="http://ackerleytng.github.io/about/">Learn More</a></li>
				<li>
					<a href="mailto:ackerleytng@gmail.com"><i class="fa fa-envelope"></i> Email</a>
				</li>
				
				
				
				
				
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://ackerleytng.github.io/posts/">All Posts</a></li>
				<li><a href="http://ackerleytng.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  <div class="image-credit">Image source: <a href="http://www.dargadgetz.com/ios-7-abstract-wallpaper-pack-for-iphone-5-and-ipod-touch-retina/">dargadgetz</a></div><!-- /.image-credit -->
  
    <div class="entry-image">
      <img src="http://ackerleytng.github.io/images/abstract-1.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Ackerley's Blog</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-04-11T00:00:00+08:00"><a href="http://ackerleytng.github.io/linux-nfs-mini2440/">April 11, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://ackerleytng.github.io/about/" title="About Ackerley Tng">Ackerley Tng</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://ackerleytng.github.io/linux-nfs-mini2440/#disqus_thread">Comment</a></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://ackerleytng.github.io/linux-nfs-mini2440/" rel="bookmark" title="Putting Linux on mini2440 with nfs root filesystem" itemprop="url">Putting Linux on mini2440 with nfs root filesystem</a></h1>
    
  </header>
  <div class="entry-content">
    <p>The <a href="/linux-mini2440/">previous post</a> showed how to put Linux on the mini2440.</p>

<p>To facilitate development on the mini2440, it is advantageous to have a network file system as a rootfs:</p>

<ul>
<li>Easily compile on the host and run it on the mini2440 without having to do troublesome transfers</li>
<li>Won&#39;t be wasting write cycles on the flash</li>
</ul>

<h1>Setting up the nfs server</h1>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo apt-get install nfs-kernel-server
</code></pre></div>
<p>You just need to add a single line to the configuration in <code>/etc/exports</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/export/fs 192.168.1.0/24(rw,fsid=0,insecure,no_subtree_check,async,no_root_squash)
</code></pre></div>
<p>Untar <code>output/images/rootfs.tar</code> into <code>/export/fs</code>.</p>

<p>Your <code>/export/fs</code> should look like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ ls -al /export/fs/
total 72
drwxrwxr-x 18 root root 4096 Apr  6 23:21 .
drwxr-xr-x  3 root root 4096 Apr  6 23:21 ..
drwxrwxr-x  2 root root 4096 Apr  5 21:59 bin
drwxr-xr-x  3 root root 4096 Apr 11 11:14 dev
drwxr-xr-x  5 root root 4096 Apr 11 11:15 etc
drwxrwxr-x  3 root root 4096 Mar  2 05:26 home
drwxrwxr-x  3 root root 4096 Apr  5 21:59 lib
lrwxrwxrwx  1 root root    3 Apr  5 21:11 lib32 -&gt; lib
lrwxrwxrwx  1 root root   11 Apr  5 21:45 linuxrc -&gt; bin/busybox
drwxrwxr-x  2 root root 4096 Mar  2 05:26 media
drwxrwxr-x  2 root root 4096 Mar  2 05:26 mnt
drwxrwxr-x  2 root root 4096 Mar  2 05:26 opt
drwxrwxr-x  2 root root 4096 Mar  2 05:26 proc
drwx------  2 root root 4096 Apr 11 11:16 root
drwxrwxr-x  2 root root 4096 Apr 11 11:14 run
drwxrwxr-x  2 root root 4096 Apr  5 21:59 sbin
drwxrwxr-x  2 root root 4096 Mar  2 05:26 sys
drwxrwxrwt  3 root root 4096 Apr  5 21:59 tmp
drwxrwxr-x  6 root root 4096 Apr  5 21:45 usr
drwxrwxr-x  4 root root 4096 Apr  5 22:01 var
</code></pre></div>
<p>Note that the symlinks should be there.</p>

<p>You might need to turn off the firewall to enable access</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo disable ufw
</code></pre></div>
<p>If you wish to test this setup, you could use another linux/mac computer:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ showmount -e 192.168.1.50
Exports list on 192.168.1.50:
/export/fs                          192.168.1.0/24
/export                             192.168.1.0/24
</code></pre></div>
<p>and then</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ mkdir tmp
$ mount -t nfs 192.168.1.50:/export/fs/ tmp/
$ ls tmp/
bin     dev     etc     home    lib     lib32   linuxrc media   mnt     opt     proc    root    run     sbin    sys     tmp     usr     var
</code></pre></div>
<p>The following is <em>wrong</em>; you won&#39;t be able to boot.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ ls tmp/
fs
</code></pre></div>
<p>Now go to the mini2440. Interrupt boot if necessary by pressing enter at this prompt</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Hit any key to stop autoboot:  0
MINI2440 #
</code></pre></div>
<p>Then</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # setenv bootargs console=ttySAC0,115200 root=/dev/nfs nfsroot=192.168.1.50:/export/fs rw ip=192.168.1.60 noinitrd
MINI2440 # saveenv
MINI2440 # boot
</code></pre></div>
<p><code>ip</code> is the address you want to assign to your mini2440 and <code>nfsroot</code> should point the mini2440 to your server.</p>

<p><code>/dev/nfs</code> need not exist in <code>/export/fs/dev</code> for mounting to be successful.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-04-06T00:00:00+08:00"><a href="http://ackerleytng.github.io/linux-jffs-mini2440/">April 06, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://ackerleytng.github.io/about/" title="About Ackerley Tng">Ackerley Tng</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://ackerleytng.github.io/linux-jffs-mini2440/#disqus_thread">Comment</a></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://ackerleytng.github.io/linux-jffs-mini2440/" rel="bookmark" title="Putting Linux on mini2440 with jffs2 filesystem" itemprop="url">Putting Linux on mini2440 with jffs2 filesystem</a></h1>
    
  </header>
  <div class="entry-content">
    <p>The <a href="/linux-mini2440/">previous post</a> showed how to put Linux on the mini2440.</p>

<p>If you log in at the login prompt by entering the username root, you would be taken to <code>/root</code>. If you try writing to the filesystem,</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># touch test
</code></pre></div>
<p>and you restart the device</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"># reboot
</code></pre></div>
<p>you will find that the file is not saved. To be able to write to the flash, we can place a jffs2 filesystem on the mini2440.</p>

<h2>Building the kernel and root file system</h2>

<p>Using the same version of buildroot from the <a href="/linux-mini2440/">previous post</a>, I did <code>make menuconfig</code>.</p>

<p>Deselect <code>initial RAM filesystem linked into linux kernel</code> and deselect <code>cpio the root filesystem (for use as an initial RAM filesystem)</code></p>

<p>I also selected <code>jffs2 root filesystem</code> and for <code>Flash Type</code>, I selected <code>NAND flash with 2kB Page and 128 kB erasesize</code></p>

<p>Then...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">make
</code></pre></div>
<h2>Conceptually,</h2>

<p>You want to put U-Boot, a bootloader, into NAND flash, which will then load your linux kernel, which would in turn load your root filesystem.</p>

<p>You can use the U-Boot bootloader if it is already on the mini2440&#39;s NAND flash.</p>

<h2>Transferring uImage into NAND flash</h2>

<p>Find the address of the kernel partition:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # mtdparts

device nand0 &lt;mini2440-nand&gt;, # parts = 4
 #: name                        size            offset          mask_flags
 0: u-boot              0x00040000      0x00000000      0
 1: u-boot_env          0x00020000      0x00040000      0
 2: kernel              0x00500000      0x00060000      0
 3: rootfs              0x0faa0000      0x00560000      0

active partition: nand0,0 - (u-boot) 0x00040000 @ 0x00000000

defaults:
mtdids  : nand0=mini2440-nand
mtdparts: &lt;NULL&gt;
</code></pre></div>
<p>Erase the kernel partition:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# nand erase 60000 500000
</code></pre></div>
<p>Download uImage from Linux PC over LAN into RAM, at 0x32000000 again. First place <code>uImage</code> into <code>/tftpboot</code> (Google how to set up tftp).</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# tftp 32000000 uImage
</code></pre></div>
<p>Copy uImage from ram into NAND</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# nand write.e 32000000 60000 &lt;size-of-uImage-in-hex&gt;
</code></pre></div>
<p>Set the boot command to load kernel image from NAND flash.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# setenv bootcmd &#39;nboot.e kernel;bootm&#39;
MINI2440# saveenv
</code></pre></div>
<h2>Transferring <code>rootfs.jffs2</code> into NAND flash</h2>

<p>Copy <code>rootfs.jffs2</code> from <code>buildroot-2015.02/output/images/</code> into <code>/tftpboot/</code>.</p>

<p>Erase the rootfs partition:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# nand erase rootfs
</code></pre></div>
<p>Download <code>rootfs.jffs2</code> from Linux PC over LAN into RAM, at 0x32000000 again.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# tftp 32000000 rootfs.jffs2
</code></pre></div>
<p>Copy uImage from ram into NAND</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# nand write.e 32000000 560000 &lt;size-of-rootfs.jffs2-in-hex&gt;
</code></pre></div>
<p>Set the boot command to load kernel image from NAND flash.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# setenv bootcmd &#39;nboot.e kernel;bootm&#39;
MINI2440# setenv bootargs &#39;root=/dev/mtdblock3 rootfstype=jffs2 console=ttySAC0,115200&#39;
MINI2440# saveenv
</code></pre></div>
<p>Power cycle the mini2440.</p>

<h2>Full U-Boot environment for reference</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # printenv
bootargs=root=/dev/mtdblock3 rootfstype=jffs2 console=ttySAC0,115200
bootdelay=3
baudrate=115200
ethaddr=08:08:11:18:12:27
usbtty=cdc_acm
mini2440=mini2440=0tb
bootargs_base=console=ttySAC0,115200 noinitrd
bootargs_init=init=/sbin/init
root_nand=root=/dev/mtdblock3 rootfstype=jffs2
root_mmc=root=/dev/mmcblk0p2 rootdelay=2
root_nfs=/mnt/nfs
set_root_nfs=setenv root_nfs root=/dev/nfs rw nfsroot=${serverip}:${root_nfs}
ifconfig_static=run setenv ifconfig ip=${ipaddr}:${serverip}::${netmask}:mini2440:eth0
ifconfig_dhcp=run setenv ifconfig ip=dhcp
ifconfig=ip=dhcp
set_bootargs_mmc=setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_mmc}
set_bootargs_nand=setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_nand}
set_bootargs_nfs=run set_root_nfs; setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_nfs} ${ifconfig}
mtdids=nand0=mini2440-nand
mtdparts=mtdparts=mini2440-nand:0x00040000(u-boot),0x00020000(u-boot_env),0x00500000(kernel),0x0faa0000(rootfs)
bootcmd=nboot.e kernel;bootm
filesize=51A630
fileaddr=32000000
netmask=255.255.255.0
ipaddr=192.168.1.60
serverip=192.168.1.50
partition=nand0,0
mtddevnum=0
mtddevname=u-boot
</code></pre></div>
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2015-04-05T00:00:00+08:00"><a href="http://ackerleytng.github.io/linux-mini2440/">April 05, 2015</a></time></span><span class="author vcard"><span class="fn"><a href="http://ackerleytng.github.io/about/" title="About Ackerley Tng">Ackerley Tng</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://ackerleytng.github.io/linux-mini2440/#disqus_thread">Comment</a></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~7 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://ackerleytng.github.io/linux-mini2440/" rel="bookmark" title="Putting Linux on mini2440" itemprop="url">Putting Linux on mini2440</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I hope to make this</p>

<ul>
<li>Pain free</li>
<li>As close to first principles as possible so when new versions come out you can still follow this guide</li>
</ul>

<h2>Building the kernel and root file system</h2>

<p>I grabbed the latest version of buildroot off http://buildroot.uclibc.org/downloads/.</p>

<p>The version I got was <code>2015.02</code>. I managed to get Linux 3.18.6 working on the mini2440, but you might want the newest version at the point you&#39;re doing this.</p>

<p>Untar the tarball and go to the extracted directory.</p>

<p>Type <code>make menuconfig</code>.</p>

<p>I tried using the mini2440 defconfig (as in default config), but I kinda tried so many different things that I don&#39;t know which of those are still valid. If you&#39;d like to try the mini2440 defconfig, or at least use that as a starting point, go to <code>&lt; Load &gt;</code> and load <code>configs/mini2440_defconfig</code>.</p>

<p>If not, here&#39;s my final configuration.</p>

<ul>
<li>Target Architecture: ARM (little endian)</li>
<li>Target Binary Format: ELF</li>
<li>Target Architecture Variant: arm920t</li>
<li>Target ABI: EABI</li>
<li>Floating point strategy: Soft float</li>
<li>ARM instruction set: ARM</li>
</ul>

<p>I changed the <code>System hostname</code> and <code>System banner</code> in <code>System configuration</code>, but those are cosmetic.</p>

<p>For Linux kernel configuration, I used a defconfig, and the name of the defconfig is <code>mini2440</code>.</p>

<p>I am using <code>uImage</code> for the <code>Kernel binary format</code></p>

<p>As for filesystem, I selected <code>initial RAM filesystem linked into linux kernel</code></p>

<p>I also selected <code>jffs2 root filesystem</code> and for <code>Flash Type</code>, I selected <code>NAND flash with 2kB Page and 128 kB erasesize</code></p>

<p>This version of buildroot doesn&#39;t build U-Boot properly due to a missing defconfig, so I did not select any bootloader.</p>

<p>Then...</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">make
</code></pre></div>
<h1>Putting U-boot on mini2440</h1>

<p>I got a compiled version of U-boot from http://www.mech.tohoku-gakuin.ac.jp/rde/contents/tech/mini2440/archive/u-boot_20100701.zip, but just in case that file disappears, <a href="/post_downloads/u-boot_20100701.zip">u-boot_20100701.zip</a>.</p>

<p>This zip file contains two tools that you might need to transfer files over USB to the mini2440. After you extract the files in the archive, they will be in the <code>tools/</code> directory. I don&#39;t think there is a difference between <code>s3c2410_boot_usb</code> and <code>usbpush</code>.</p>

<h2>Hardware connections</h2>

<ul>
<li>Connect the mini2440 to power</li>
<li>Connect the mini2440 to a USB port on your Linux PC using a Type A (male) to Type B (male) USB cable</li>
<li>Connect the mini2440 to a serial port on your Linux PC using a serial cable</li>
</ul>

<p>Start minicom</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo minicom -s
</code></pre></div>
<p>Here are my settings</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    +-----------------------------------------------------------------------+
    | A -    Serial Device      : /dev/ttyS0                                |
    | B - Lockfile Location     : /var/lock                                 |
    | C -   Callin Program      :                                           |
    | D -  Callout Program      :                                           |
    | E -    Bps/Par/Bits       : 115200 8N1                                |
    | F - Hardware Flow Control : No                                        |
    | G - Software Flow Control : No                                        |
    |                                                                       |
    |    Change which setting?                                              |
    +-----------------------------------------------------------------------+
            | Screen and keyboard      |
            | Save setup as dfl        |
            | Save setup as..          |
            | Exit                     |
            | Exit from Minicom        |
            +--------------------------+
</code></pre></div>
<p>If you set the NAND/NOR switch on the mini2440 to NOR and power up the mini2440, you should see something like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">##### FriendlyARM BIOS 2.0 for 2440 #####
[x] format NAND FLASH for Linux
[v] Download vivi
[k] Download linux kernel
[y] Download root_yaffs image
[a] Absolute User Application
[n] Download Nboot for WinCE
[l] Download WinCE boot-logo
[w] Download WinCE NK.bin
[d] Download &amp; Run
[z] Download zImage into RAM
[g] Boot linux from RAM
[f] Format the nand flash
[b] Boot the system
[s] Set the boot parameters
[u] Backup NAND Flash to HOST through USB(upload)
[r] Restore NAND Flash from HOST through USB
[q] Goto shell of vivi
Enter your selection:
</code></pre></div>
<h2>Conceptually,</h2>

<p>You want to put U-Boot, a bootloader, into NAND flash, which will then load your linux kernel, which would in turn load your root filesystem.</p>

<p>Here&#39;s the final layout you want to achieve</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # mtdparts

device nand0 &lt;mini2440-nand&gt;, # parts = 4
 #: name                        size            offset          mask_flags
 0: u-boot              0x00040000      0x00000000      0
 1: u-boot_env          0x00020000      0x00040000      0
 2: kernel              0x00500000      0x00060000      0
 3: rootfs              0x0faa0000      0x00560000      0

active partition: nand0,0 - (u-boot) 0x00040000 @ 0x00000000

defaults:
mtdids  : nand0=mini2440-nand
mtdparts: &lt;NULL&gt;
</code></pre></div>
<h2>Putting U-Boot into NAND flash</h2>

<p>In this section, you&#39;re going to first put U-Boot onto mini2440&#39;s ram, and then run U-Boot from ram to make it do some cleanup, and then get U-Boot to copy itself into NAND flash.</p>

<p>Ask mini2440 to receive U-Boot:</p>

<p>In minicom:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">##### FriendlyARM BIOS 2.0 for 2440 #####
[x] format NAND FLASH for Linux
[v] Download vivi
[k] Download linux kernel
[y] Download root_yaffs image
[a] Absolute User Application
[n] Download Nboot for WinCE
[l] Download WinCE boot-logo
[w] Download WinCE NK.bin
[d] Download &amp; Run
[z] Download zImage into RAM
[g] Boot linux from RAM
[f] Format the nand flash
[b] Boot the system
[s] Set the boot parameters
[u] Backup NAND Flash to HOST through USB(upload)
[r] Restore NAND Flash from HOST through USB
[q] Goto shell of vivi
Enter your selection:
</code></pre></div>
<p>Press <code>q</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Supervivi&gt; load ram &lt;destination-address-in-ram&gt; &lt;size-to-transfer&gt; u
</code></pre></div>
<p>What I used:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Supervivi&gt; load ram 0x32000000 242360 u
</code></pre></div>
<p>Send U-Boot over USB to mini2440. I used <code>u-boot-256M.bin</code>, because my mini2440 had a flash size of 256M. Many sites say that there should be no difference between using <code>u-boot-256M.bin</code> and <code>u-boot-128M.bin</code>, but I used <code>u-boot-256M.bin</code> anyway. On Linux PC:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ sudo ./tools/s3c2410_boot_usb u-boot_20100701/u-boot-256M.bin
</code></pre></div>
<p>(Ignore the error if you get one)</p>

<p>Start U-Boot</p>

<p>In minicom:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Supervivi&gt; go 0x32000000
</code></pre></div>
<p>Clear everything in NAND flash</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # nand scrub
</code></pre></div>
<p>Create bad block table (This took quite a while for me, be patient)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # nand createbbt
</code></pre></div>
<p>Create/view partitions</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # mtdparts
</code></pre></div>
<p>Write uboot to NAND flash. You have some options here.</p>

<p>Raw write, doesn&#39;t look for bad blocks, data might get written to bad block. This will copy the full size of the nand partition, beginning with the address in ram provided.
<code>
MINI2440 # nand write &lt;address-in-ram-in-hex&gt; &lt;partition-in-nand&gt;
</code></p>

<p>Write, taking into account bad blocks
<code>
MINI2440 # nand write.e &lt;source-in-hex&gt; &lt;destination-in-hex&gt; &lt;bytes-to-write-in-hex&gt;
</code></p>

<p>I used</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # nand write 0x32000000 u-boot
</code></pre></div>
<p>Partition the NAND</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# dynpart
</code></pre></div>
<p>Create the dynamic environment space for u-boot</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# dynenv set u-boot_env
</code></pre></div>
<p>Save the environment to NAND.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# saveenv
</code></pre></div>
<p>Switch off the mini2440, flip the NAND/NOR switch to NAND, and switch on the mini2440.</p>

<p>You should get to a <code>MINI2440#</code> prompt. If you don&#39;t, try pressing enter a few times in minicom, the prompt might show up then.</p>

<h2>Transferring uImage into NAND flash</h2>

<p>I transferred using tftp, but you might be able to do it using USB like above.</p>

<p>Find the address of the kernel partition:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # mtdparts

device nand0 &lt;mini2440-nand&gt;, # parts = 4
 #: name                        size            offset          mask_flags
 0: u-boot              0x00040000      0x00000000      0
 1: u-boot_env          0x00020000      0x00040000      0
 2: kernel              0x00500000      0x00060000      0
 3: rootfs              0x0faa0000      0x00560000      0

active partition: nand0,0 - (u-boot) 0x00040000 @ 0x00000000

defaults:
mtdids  : nand0=mini2440-nand
mtdparts: &lt;NULL&gt;
</code></pre></div>
<p>Erase the kernel partition:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# nand erase 60000 500000
</code></pre></div>
<p>Set up your network. I connected the mini2440 to my router, and the Linux PC to the router at 192.168.1.50</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# setenv ipaddr 192.168.1.60
MINI2440# setenv serverip 192.168.1.50
</code></pre></div>
<p>Download uImage from Linux PC over LAN into RAM, at 0x32000000 again. First place <code>uImage</code> into <code>/tftpboot</code> (Google how to set up tftp).</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# tftp 32000000 uImage
</code></pre></div>
<p>Copy uImage from ram into NAND</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# nand write.e 32000000 60000 &lt;size-of-uImage-in-hex&gt;
</code></pre></div>
<p>Set the boot command to load kernel image from NAND flash.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440# setenv bootcmd &#39;nboot.e kernel;bootm&#39;
MINI2440# saveenv
</code></pre></div>
<p>Power cycle the mini2440, and it should boot into Linux.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Loading from NAND 256MiB 3,3V 8-bit, offset 0x60000
   Image Name:   Linux-3.18.6
   Created:      2015-04-05   4:34:50 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    5350896 Bytes =  5.1 MB
   Load Address: 30008000
   Entry Point:  30008000
## Booting kernel from Legacy Image at 32000000 ...
   Image Name:   Linux-3.18.6
   Created:      2015-04-05   4:34:50 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    5350896 Bytes =  5.1 MB
   Load Address: 30008000
   Entry Point:  30008000
   Verifying Checksum ... OK
   Loading Kernel Image ...
...
</code></pre></div>
<h2>Here&#39;s my entire U-Boot environment, just in case...</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">MINI2440 # printenv
bootargs=root=/dev/mtdblock3 rootfstype=jffs2 console=ttySAC0,115200
bootdelay=3
baudrate=115200
ethaddr=08:08:11:18:12:27
netmask=255.255.255.0
usbtty=cdc_acm
mini2440=mini2440=0tb
bootargs_base=console=ttySAC0,115200 noinitrd
bootargs_init=init=/sbin/init
root_nand=root=/dev/mtdblock3 rootfstype=jffs2
root_mmc=root=/dev/mmcblk0p2 rootdelay=2
root_nfs=/mnt/nfs
set_root_nfs=setenv root_nfs root=/dev/nfs rw nfsroot=${serverip}:${root_nfs}
ifconfig_static=run setenv ifconfig ip=${ipaddr}:${serverip}::${netmask}:mini2440:eth0
ifconfig_dhcp=run setenv ifconfig ip=dhcp
ifconfig=ip=dhcp
set_bootargs_mmc=setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_mmc}
set_bootargs_nand=setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_nand}
set_bootargs_nfs=run set_root_nfs; setenv bootargs ${bootargs_base} ${bootargs_init} ${mini2440} ${root_nfs} ${ifconfig}
mtdids=nand0=mini2440-nand
mtdparts=mtdparts=mini2440-nand:0x00040000(u-boot),0x00020000(u-boot_env),0x00500000(kernel),0x0faa0000(rootfs)
bootcmd=nboot.e kernel;bootm
ipaddr=192.168.1.60
serverip=192.168.1.50
partition=nand0,0
mtddevnum=0
mtddevname=u-boot

Environment size: 1151/131068 bytes
</code></pre></div>
<h1>References</h1>

<ul>
<li>http://geekwentfreak-raviteja.rhcloud.com/blog/2010/07/27/flashing-uboot-onto-nand-mini2440/</li>
<li>http://geekwentfreak-raviteja.rhcloud.com/blog/2010/09/19/mini2440-flashing-linux-uimage-into-nand/</li>
<li>http://bill.station51.net/?post/2010/01/16/U-Boot-on-Mini2440</li>
<li>http://e2e.ti.com/support/dsp/davinci<em>digital</em>media_processors/f/100/p/210595/745675</li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-11-19T00:00:00+08:00"><a href="http://ackerleytng.github.io/fried-okra/">November 19, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://ackerleytng.github.io/about/" title="About Ackerley Tng">Ackerley Tng</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://ackerleytng.github.io/fried-okra/#disqus_thread">Comment</a></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://ackerleytng.github.io/fried-okra/" rel="bookmark" title="Fried Okra!" itemprop="url">Fried Okra!</a></h1>
    
  </header>
  <div class="entry-content">
    <p>First try:</p>

<p><img src="http://ackerleytng.github.io/post_images/fried-okra-0.jpg" alt="fried-okra-0"></p>

<p>Second try:</p>

<p><img src="http://ackerleytng.github.io/post_images/fried-okra-1.jpg" alt="fried-okra-1"></p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-11-16T00:00:00+08:00"><a href="http://ackerleytng.github.io/sunday-dinner/">November 16, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://ackerleytng.github.io/about/" title="About Ackerley Tng">Ackerley Tng</a></span></span>&nbsp; &bull; &nbsp;<span class="entry-comments"><a href="http://ackerleytng.github.io/sunday-dinner/#disqus_thread">Comment</a></span>
      
      <span class="entry-reading-time pull-right">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://ackerleytng.github.io/sunday-dinner/" rel="bookmark" title="Sunday Special Dinner" itemprop="url">Sunday Special Dinner</a></h1>
    
  </header>
  <div class="entry-content">
    <p><img src="http://ackerleytng.github.io/post_images/pan-fried-chicken-potatoes.jpg" alt="fried-okra-0"></p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->


<div class="pagination">
  
    Previous
  
  <ul class="inline-list">
    <li>
      
        <span class="current-page">1</span>
      
    </li>
    
      <li>
        
          <a href="http://ackerleytng.github.io/page2">2</a>
        
      </li>
    
      <li>
        
          <a href="http://ackerleytng.github.io/page3">3</a>
        
      </li>
    
      <li>
        
          <a href="http://ackerleytng.github.io/page4">4</a>
        
      </li>
    
      <li>
        
          <a href="http://ackerleytng.github.io/page5">5</a>
        
      </li>
    
  </ul>
  
    <a href="http://ackerleytng.github.io/page2" class="btn">Next</a>
  
</div><!-- /.pagination -->

</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Ackerley Tng. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://ackerleytng.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://ackerleytng.github.io/assets/js/scripts.min.js"></script>

          

</body>
</html>